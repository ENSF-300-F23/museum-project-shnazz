import mysql.connector
from mysql.connector import Error, errorcode

user = "admin"
password = "admin"
database = "museum"

def auth_check(username, password, database):
    while True:
        try:
            cnct = mysql.connector.connect(
            host = "localhost",
            user = username,
            password = password,
            database = database)
            crs = cnct.cursor(buffered=True)
            break

        except Error as error:
                    print(error)
                    if error.errno == errorcode.ER_ACCESS_DENIED_ERROR:
                        print("Incorrect Creditials")
                        username = input("Re-enter the username")
                        password = input("Re-enter the password")
                        continue
                    elif error.errno == errorcode.ER_BAD_DB_ERROR:
                        print("Invalid Database")
                        database = input("Re-enter the database")
                    else:
                        print(f"Error: '{error}'")
                        return cnct
    
    crs.execute(f"SHOW GRANTS FOR {username}@localhost")
    grants = crs.fetchall()
    output = grants[0][0].split(",")
    if " CREATE" in output:
        admin_actions(crs,cnct)
    elif " INSERT" in output:
        employee_actions(crs, cnct)

def show_tables(cursor):
    table = []
    cursor.execute("SHOW TABLES;")
    table_names = cursor.fetchall()
    for i in table_names:
        table.append(i[0])
    print(table)

def search_table(cursor, name):
    cursor.execute((f"SELECT * FROM {name}"))
    result = cursor.fetchall()
    for i in result:
        print(i)

def search(cursor):
    show_tables(cursor)
    table = input("Enter the table you would like to view: ")
    search_table(cursor, table)
    repeat = input("Do you want to view another table (Y/N): ")
    if repeat == "Y":
        search(cursor)

def add_item(cursor, connection):
    show_tables(cursor)
    table = input("Enter the table to add to: ")
    cursor.execute(f"DESCRIBE {table}")
    columns = [column[0] for column in cursor.fetchall()]
    val = []
    for i in columns:
        in_val = input(f"Enter the value for column {i}: ")
        val.append(in_val)
    cursor.execute(f"INSERT into {table} values {tuple(val)}")
    connection.commit()
    cursor.execute(f"SELECT * FROM {table}")
    print("Data has been added")
    search_table(cursor, table)

def update_item(cursor):
    show_tables(cursor)
    table = input("Enter the table to update: ")
    cursor.execute(f"DESCRIBE {table}")
    columns = [column[0] for column in cursor.fetchall()]
    print(columns)
    attribute = input("Enter the column to update: ")
    val = input("Enter the updated value: ")
    reference_col = input("Enter the column used for reference: ")
    reference_val = input("Enter the value used for reference: ")
    cursor.execute(f"UPDATE {table} SET {attribute} = {val} WHERE {reference_col} = '{reference_val}'")
    search_table(cursor,table)

def delete_item(cursor, connection):
    show_tables(cursor)
    table = input("Enter the table to update: ")
    cursor.execute(f"DESCRIBE {table}")
    columns = [column[0] for column in cursor.fetchall()]
    print(columns)
    attribute = input("Enter the column to update: ")
    val = input("Enter the value to be deleted: ")
    cursor.execute(f"DELETE FROM {table} WHERE {attribute} = '{val}'")
    connection.commit
    search_table(cursor, table)

def read_file(cursor, connection):
    path = input("Enter the file path: ")
    with open(path, "r") as file:
        data = file.readlines()

    for i in data:
        cursor.execute(i)

        words = i.split(" ")
        if 'SELECT' in words:
            result = cursor.fetchall()
            for i in result:
                print(i)
        if 'INSERT' in words or "DELETE" in words:
            connection.commit()